# API Gateway для Новостного Сервиса

API Gateway предоставляет унифицированный доступ к микросервисам новостей и комментариев.

## Конфигурация

- **URL сервиса api gateway**: http://localhost:8081
- **URL сервиса новостей**: http://localhost:8080
- **URL сервиса комментариев**: http://localhost:8082

## API-эндпоинты

### Новости

#### Получение списка новостей (краткий формат)

```
GET /api/news
```

**Параметры запроса:**
- `page` - номер страницы (по умолчанию 1)
- `count` - количество элементов на страницу (по умолчанию 10)
- `s` - поисковый запрос (фильтрует новости по заголовку)

**Пример запроса:**
```
GET http://localhost:8081/api/news?page=1&count=5&s=спорт
```

**Пример ответа:**
```json
{
  "items": [
    {
      "id": 1,
      "title": "Новость про спорт",
      "pub_date": "2023-01-15",
      "source_url": "http://example.com/news/1"
    },
    {
      "id": 2,
      "title": "Спортивное мероприятие",
      "pub_date": "2023-01-16",
      "source_url": "http://example.com/news/2"
    }
  ],
  "total_pages": 1,
  "current_page": 1,
  "items_per_page": 5,
  "total_items": 2
}
```

#### Получение полных новостей (с описанием)

```
GET /api/fullnews
```

**Параметры запроса:**
- `page` - номер страницы (по умолчанию 1)
- `count` - количество элементов на страницу (по умолчанию 10)
- `s` - поисковый запрос (фильтрует новости по заголовку)

**Пример запроса:**
```
GET http://localhost:8081/api/fullnews?page=1&count=5
```

**Пример ответа:**
```json
{
  "items": [
    {
      "id": 1,
      "title": "Заголовок новости",
      "description": "Полное описание новости с текстом статьи",
      "pub_date": "2023-01-15",
      "source_url": "http://example.com/news/1",
      "created_at": "2023-01-15T12:30:45Z"
    }
  ],
  "total_pages": 1,
  "current_page": 1,
  "items_per_page": 5,
  "total_items": 1
}
```

#### Получение новости по ID

```
GET /api/news/{newsId}
```

**Пример запроса:**
```
GET http://localhost:8081/api/news/42
```

**Пример ответа:**
```json
{
  "id": 42,
  "title": "Заголовок новости",
  "description": "Полное описание новости",
  "pub_date": "2023-01-15",
  "source_url": "http://example.com/news/42",
  "created_at": "2023-01-15T12:30:45Z"
}
```

#### Получение новости с комментариями

```
GET /api/news?comm={newsId}
```

**Пример запроса:**
```
GET http://localhost:8081/api/news?comm=42
```

**Пример ответа:**
```json
{
  "news": {
    "id": 42,
    "title": "Заголовок новости",
    "description": "Полное описание новости",
    "pub_date": "2023-01-15",
    "source_url": "http://example.com/news/42",
    "created_at": "2023-01-15T12:30:45Z"
  },
  "comments": [
    {
      "id": 1,
      "news_id": 42,
      "text": "Это первый комментарий к новости",
      "created_at": "2023-01-16T10:20:30Z"
    },
    {
      "id": 2,
      "news_id": 42,
      "text": "Это второй комментарий",
      "created_at": "2023-01-16T11:25:40Z"
    }
  ]
}
```

### Комментарии

#### Получение комментариев к новости

```
GET /api/comments?id={newsId}
```

**Параметры запроса:**
- `id` - ID новости, комментарии к которой нужно получить

**Пример запроса:**
```
GET http://localhost:8081/api/comments?id=42
```

**Пример ответа:**
```json
[
  {
    "id": 1,
    "news_id": 42,
    "text": "Комментарий к новости"
  },
  {
    "id": 2,
    "news_id": 42,
    "text": "Другой комментарий"
  }
]
```

#### Добавление комментария к новости

```
POST /api/comments/add?news_id={newsId}
```

**Параметры запроса:**
- `news_id` - ID новости, к которой добавляется комментарий (можно также использовать параметр `id`)

**Тело запроса (формат JSON):**
```json
{
  "text": "Текст комментария"
}
```

**Пример запроса:**
```
POST http://localhost:8081/api/comments/add?news_id=42
Content-Type: application/json

{
  "text": "Это мой комментарий к новости"
}
```

**Пример ответа:**
```json
{
  "id": 3
}
```

## Обработка ошибок

API Gateway возвращает следующие HTTP-статусы и сообщения об ошибках:

- **400 Bad Request** - неверные параметры запроса
- **404 Not Found** - запрашиваемый ресурс не найден
- **405 Method Not Allowed** - неподдерживаемый HTTP-метод
- **500 Internal Server Error** - внутренняя ошибка сервера

Формат ответа в случае ошибки:
```json
{
  "error": "Описание ошибки"
}
```

## Идентификация запросов

Все запросы к API Gateway можно отслеживать с помощью уникального идентификатора `request_id`:

- Вы можете передать свой `request_id` в параметрах запроса
- Если `request_id` не указан, API Gateway автоматически сгенерирует его
- Полученный `request_id` возвращается в заголовке ответа `X-Request-ID`
- Этот же `request_id` передается всем микросервисам для трассировки запросов

Пример запроса с указанием `request_id`:
```
GET http://localhost:8081/api/news?request_id=my-unique-id-123
```



## Поиск по новостям

Поиск по новостям осуществляется через параметр `s` в API новостей:

```
GET http://localhost:8081/api/news?s=ключевое+слово
GET http://localhost:8081/api/fullnews?s=ключевое+слово
```

### Пагинация
Эндпоинты для получения списков поддерживают пагинацию через параметры `page` и `count`. Ответ содержит метаданные о пагинации: текущая страница, количество элементов на странице, общее количество страниц и элементов. 